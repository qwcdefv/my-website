<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—²ç‰©æ ¡å›­ - åŠŸèƒ½æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #495057;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
        }
        
        .nav-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }
        
        .tab-content {
            padding: 30px;
            min-height: 500px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .item-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .item-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .item-price {
            font-size: 1.4em;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .item-description {
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item-category {
            background: #e9ecef;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #495057;
        }
        
        .item-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-sold {
            background: #f8d7da;
            color: #721c24;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid transparent;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .demo-actions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .demo-actions h4 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ é—²ç‰©æ ¡å›­</h1>
            <p>æ ¡å›­äºŒæ‰‹äº¤æ˜“å¹³å° - åŠŸèƒ½æ¼”ç¤º</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">ç³»ç»Ÿæ¦‚è§ˆ</button>
            <button class="nav-tab" onclick="showTab('user')">ç”¨æˆ·ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('items')">ç‰©å“ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('transactions')">äº¤æ˜“ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('demo')">åŠŸèƒ½æ¼”ç¤º</button>
        </div>
        
        <div class="tab-content">
            <!-- ç³»ç»Ÿæ¦‚è§ˆ -->
            <div id="overview" class="tab-pane active">
                <h2>ğŸ“Š ç³»ç»Ÿæ•°æ®æ¦‚è§ˆ</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="userCount">0</div>
                        <div class="stat-label">æ³¨å†Œç”¨æˆ·</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="itemCount">0</div>
                        <div class="stat-label">å‘å¸ƒç‰©å“</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="transactionCount">0</div>
                        <div class="stat-label">äº¤æ˜“è®°å½•</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeUserCount">0</div>
                        <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
                    </div>
                </div>
                
                <div class="demo-actions">
                    <h4>ğŸš€ å¿«é€Ÿæ“ä½œ</h4>
                    <button class="btn btn-primary" onclick="initializeDemoData()">åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®</button>
                    <button class="btn btn-secondary" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                    <button class="btn btn-success" onclick="refreshStats()">åˆ·æ–°ç»Ÿè®¡</button>
                </div>
                
                <div id="overviewMessage"></div>
            </div>
            
            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="user" class="tab-pane">
                <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
                
                <div class="grid">
                    <div>
                        <h3>ç”¨æˆ·æ³¨å†Œ</h3>
                        <form id="registerForm">
                            <div class="form-group">
                                <label>ç”¨æˆ·å</label>
                                <input type="text" id="regUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                            </div>
                            <div class="form-group">
                                <label>é‚®ç®±</label>
                                <input type="email" id="regEmail" placeholder="è¯·è¾“å…¥é‚®ç®±" required>
                            </div>
                            <div class="form-group">
                                <label>æ ¡å›­ID</label>
                                <input type="text" id="regCampusId" placeholder="è¯·è¾“å…¥å­¦å·" required>
                            </div>
                            <div class="form-group">
                                <label>å¯†ç </label>
                                <input type="password" id="regPassword" placeholder="è¯·è¾“å…¥å¯†ç " required>
                            </div>
                            <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
                        </form>
                    </div>
                    
                    <div>
                        <h3>ç”¨æˆ·ç™»å½•</h3>
                        <form id="loginForm">
                            <div class="form-group">
                                <label>é‚®ç®±</label>
                                <input type="email" id="loginEmail" placeholder="è¯·è¾“å…¥é‚®ç®±" required>
                            </div>
                            <div class="form-group">
                                <label>å¯†ç </label>
                                <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " required>
                            </div>
                            <button type="submit" class="btn btn-primary">ç™»å½•</button>
                            <button type="button" class="btn btn-secondary" onclick="logout()">ç™»å‡º</button>
                        </form>
                    </div>
                </div>
                
                <div id="userMessage"></div>
                <div id="currentUser"></div>
                <div id="userList"></div>
            </div>
            
            <!-- ç‰©å“ç®¡ç† -->
            <div id="items" class="tab-pane">
                <h2>ğŸ“¦ ç‰©å“ç®¡ç†</h2>
                
                <div class="grid">
                    <div>
                        <h3>å‘å¸ƒç‰©å“</h3>
                        <form id="itemForm">
                            <div class="form-group">
                                <label>ç‰©å“åç§°</label>
                                <input type="text" id="itemTitle" placeholder="è¯·è¾“å…¥ç‰©å“åç§°" required>
                            </div>
                            <div class="form-group">
                                <label>ç‰©å“æè¿°</label>
                                <textarea id="itemDescription" placeholder="è¯·è¾“å…¥ç‰©å“æè¿°" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>ä»·æ ¼</label>
                                <input type="number" id="itemPrice" placeholder="è¯·è¾“å…¥ä»·æ ¼" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>åˆ†ç±»</label>
                                <select id="itemCategory" required>
                                    <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                                    <option value="ä¹¦ç±">ä¹¦ç±</option>
                                    <option value="ç”µå­äº§å“">ç”µå­äº§å“</option>
                                    <option value="ç”Ÿæ´»ç”¨å“">ç”Ÿæ´»ç”¨å“</option>
                                    <option value="æœè£…">æœè£…</option>
                                    <option value="å…¶ä»–">å…¶ä»–</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">å‘å¸ƒç‰©å“</button>
                        </form>
                    </div>
                    
                    <div>
                        <h3>æœç´¢ç‰©å“</h3>
                        <div class="form-group">
                            <label>æœç´¢å…³é”®è¯</label>
                            <input type="text" id="searchKeyword" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯">
                        </div>
                        <div class="form-group">
                            <label>åˆ†ç±»ç­›é€‰</label>
                            <select id="searchCategory">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                <option value="ä¹¦ç±">ä¹¦ç±</option>
                                <option value="ç”µå­äº§å“">ç”µå­äº§å“</option>
                                <option value="ç”Ÿæ´»ç”¨å“">ç”Ÿæ´»ç”¨å“</option>
                                <option value="æœè£…">æœè£…</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="searchItems()">æœç´¢</button>
                        <button class="btn btn-secondary" onclick="loadAllItems()">æ˜¾ç¤ºå…¨éƒ¨</button>
                    </div>
                </div>
                
                <div id="itemMessage"></div>
                <div id="itemList"></div>
            </div>
            
            <!-- äº¤æ˜“ç®¡ç† -->
            <div id="transactions" class="tab-pane">
                <h2>ğŸ’° äº¤æ˜“ç®¡ç†</h2>
                
                <div class="demo-actions">
                    <h4>äº¤æ˜“æ“ä½œ</h4>
                    <button class="btn btn-primary" onclick="createTransaction()">åˆ›å»ºæµ‹è¯•äº¤æ˜“</button>
                    <button class="btn btn-secondary" onclick="loadTransactions()">æŸ¥çœ‹äº¤æ˜“è®°å½•</button>
                </div>
                
                <div id="transactionMessage"></div>
                <div id="transactionList"></div>
            </div>
            
            <!-- åŠŸèƒ½æ¼”ç¤º -->
            <div id="demo" class="tab-pane">
                <h2>ğŸ® åŠŸèƒ½æ¼”ç¤º</h2>
                
                <div class="demo-actions">
                    <h4>ä¸€é”®æ¼”ç¤º</h4>
                    <button class="btn btn-primary" onclick="runFullDemo()">è¿è¡Œå®Œæ•´æ¼”ç¤º</button>
                    <button class="btn btn-secondary" onclick="demoUserFlow()">ç”¨æˆ·æµç¨‹æ¼”ç¤º</button>
                    <button class="btn btn-success" onclick="demoItemFlow()">ç‰©å“æµç¨‹æ¼”ç¤º</button>
                </div>
                
                <div id="demoMessage"></div>
                <div id="demoLog"></div>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨é”®å
        const STORAGE_KEYS = {
            USERS: 'xianwu_users',
            ITEMS: 'xianwu_items',
            TRANSACTIONS: 'xianwu_transactions',
            CURRENT_USER: 'xianwu_current_user'
        };

        // æ˜¾ç¤ºæ ‡ç­¾é¡µ
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾æŒ‰é’®
            event.target.classList.add('active');
            
            // åˆ·æ–°å¯¹åº”çš„æ•°æ®
            refreshTabData(tabName);
        }

        // åˆ·æ–°æ ‡ç­¾é¡µæ•°æ®
        function refreshTabData(tabName) {
            switch(tabName) {
                case 'overview':
                    refreshStats();
                    break;
                case 'user':
                    displayCurrentUser();
                    displayUserList();
                    break;
                case 'items':
                    loadAllItems();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
            }
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `alert alert-${type}`;
            element.innerHTML = message;
            
            // 3ç§’åè‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯
            setTimeout(() => {
                element.innerHTML = '';
                element.className = '';
            }, 3000);
        }

        // ç”Ÿæˆå”¯ä¸€ID
        function generateId(prefix) {
            return prefix + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // è·å–å½“å‰ç”¨æˆ·
        function getCurrentUser() {
            const userData = localStorage.getItem(STORAGE_KEYS.CURRENT_USER);
            return userData ? JSON.parse(userData) : null;
        }

        // ä¿å­˜å½“å‰ç”¨æˆ·
        function setCurrentUser(user) {
            if (user) {
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(user));
            } else {
                localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
            }
        }

        // è·å–æ‰€æœ‰ç”¨æˆ·
        function getAllUsers() {
            const usersData = localStorage.getItem(STORAGE_KEYS.USERS);
            return usersData ? JSON.parse(usersData) : [];
        }

        // ä¿å­˜ç”¨æˆ·
        function saveUsers(users) {
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
        }

        // è·å–æ‰€æœ‰ç‰©å“
        function getAllItems() {
            const itemsData = localStorage.getItem(STORAGE_KEYS.ITEMS);
            return itemsData ? JSON.parse(itemsData) : [];
        }

        // ä¿å­˜ç‰©å“
        function saveItems(items) {
            localStorage.setItem(STORAGE_KEYS.ITEMS, JSON.stringify(items));
        }

        // è·å–æ‰€æœ‰äº¤æ˜“
        function getAllTransactions() {
            const transactionsData = localStorage.getItem(STORAGE_KEYS.TRANSACTIONS);
            return transactionsData ? JSON.parse(transactionsData) : [];
        }

        // ä¿å­˜äº¤æ˜“
        function saveTransactions(transactions) {
            localStorage.setItem(STORAGE_KEYS.TRANSACTIONS, JSON.stringify(transactions));
        }

        // ç³»ç»Ÿæ¦‚è§ˆåŠŸèƒ½
        function refreshStats() {
            const users = getAllUsers();
            const items = getAllItems();
            const transactions = getAllTransactions();
            const currentUser = getCurrentUser();
            
            document.getElementById('userCount').textContent = users.length;
            document.getElementById('itemCount').textContent = items.length;
            document.getElementById('transactionCount').textContent = transactions.length;
            document.getElementById('activeUserCount').textContent = currentUser ? '1' : '0';
        }

        function initializeDemoData() {
            // åˆ›å»ºæ¼”ç¤ºç”¨æˆ·
            const demoUsers = [
                {
                    user_id: generateId('user'),
                    username: 'å¼ åŒå­¦',
                    email: 'zhang@campus.edu.cn',
                    campus_id: '2021001001',
                    password: '123456',
                    is_verified: true,
                    register_time: new Date().toISOString()
                },
                {
                    user_id: generateId('user'),
                    username: 'æåŒå­¦',
                    email: 'li@campus.edu.cn',
                    campus_id: '2021001002',
                    password: '123456',
                    is_verified: true,
                    register_time: new Date().toISOString()
                }
            ];
            
            // åˆ›å»ºæ¼”ç¤ºç‰©å“
            const demoItems = [
                {
                    item_id: generateId('item'),
                    user_id: demoUsers[0].user_id,
                    title: 'é«˜ç­‰æ•°å­¦æ•™æï¼ˆåŒæµç¬¬ä¸ƒç‰ˆï¼‰',
                    description: 'ä¹æˆæ–°ï¼Œæ— åˆ’ç—•ï¼Œé€‚åˆå¤§ä¸€æ–°ç”Ÿä½¿ç”¨ï¼ŒåŸä»·68å…ƒï¼Œç°ä½ä»·å‡ºå”®',
                    price: 35.00,
                    category: 'ä¹¦ç±',
                    status: 'å¾…å”®',
                    create_time: new Date().toISOString()
                },
                {
                    item_id: generateId('item'),
                    user_id: demoUsers[1].user_id,
                    title: 'å°ç±³è“ç‰™è€³æœº',
                    description: 'ä½¿ç”¨åŠå¹´ï¼ŒåŠŸèƒ½æ­£å¸¸ï¼ŒéŸ³è´¨æ¸…æ™°ï¼Œç»­èˆªèƒ½åŠ›å¼ºï¼Œæ”¯æŒé™å™ªåŠŸèƒ½',
                    price: 120.00,
                    category: 'ç”µå­äº§å“',
                    status: 'å¾…å”®',
                    create_time: new Date().toISOString()
                },
                {
                    item_id: generateId('item'),
                    user_id: demoUsers[0].user_id,
                    title: 'å®¿èˆå°ç¯',
                    description: 'æŠ¤çœ¼LEDå°ç¯ï¼Œä¸‰æ¡£è°ƒå…‰ï¼ŒUSBä¾›ç”µï¼Œé€‚åˆå®¿èˆä½¿ç”¨',
                    price: 45.00,
                    category: 'ç”Ÿæ´»ç”¨å“',
                    status: 'å¾…å”®',
                    create_time: new Date().toISOString()
                }
            ];
            
            saveUsers(demoUsers);
            saveItems(demoItems);
            
            refreshStats();
            showMessage('overviewMessage', 'æ¼”ç¤ºæ•°æ®åˆå§‹åŒ–æˆåŠŸï¼å·²åˆ›å»º2ä¸ªç”¨æˆ·å’Œ3ä¸ªç‰©å“', 'success');
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                localStorage.removeItem(STORAGE_KEYS.USERS);
                localStorage.removeItem(STORAGE_KEYS.ITEMS);
                localStorage.removeItem(STORAGE_KEYS.TRANSACTIONS);
                localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
                
                refreshStats();
                showMessage('overviewMessage', 'æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'info');
            }
        }

        // ç”¨æˆ·ç®¡ç†åŠŸèƒ½
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const campusId = document.getElementById('regCampusId').value;
            const password = document.getElementById('regPassword').value;
            
            const users = getAllUsers();
            
            // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
            if (users.find(u => u.email === email)) {
                showMessage('userMessage', 'è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ', 'error');
                return;
            }
            
            // åˆ›å»ºæ–°ç”¨æˆ·
            const newUser = {
                user_id: generateId('user'),
                username: username,
                email: email,
                campus_id: campusId,
                password: password,
                is_verified: false,
                register_time: new Date().toISOString()
            };
            
            users.push(newUser);
            saveUsers(users);
            
            // æ¸…ç©ºè¡¨å•
            this.reset();
            
            showMessage('userMessage', 'æ³¨å†ŒæˆåŠŸï¼è¯·ç­‰å¾…æ ¡å›­èº«ä»½éªŒè¯', 'success');
            displayUserList();
        });

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const users = getAllUsers();
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                if (!user.is_verified) {
                    showMessage('userMessage', 'æ‚¨çš„è´¦å·è¿˜æœªé€šè¿‡æ ¡å›­èº«ä»½éªŒè¯', 'error');
                    return;
                }
                
                setCurrentUser(user);
                showMessage('userMessage', 'ç™»å½•æˆåŠŸï¼', 'success');
                displayCurrentUser();
                displayUserList();
                refreshStats();
            } else {
                showMessage('userMessage', 'é‚®ç®±æˆ–å¯†ç é”™è¯¯', 'error');
            }
        });

        function logout() {
            setCurrentUser(null);
            document.getElementById('loginForm').reset();
            showMessage('userMessage', 'ç™»å‡ºæˆåŠŸï¼', 'success');
            displayCurrentUser();
            displayUserList();
            refreshStats();
        }

        function displayCurrentUser() {
            const currentUser = getCurrentUser();
            const element = document.getElementById('currentUser');
            
            if (currentUser) {
                element.innerHTML = `
                    <div class="user-info">
                        <h4>å½“å‰ç™»å½•ç”¨æˆ·</h4>
                        <p><strong>ç”¨æˆ·å:</strong> ${currentUser.username}</p>
                        <p><strong>é‚®ç®±:</strong> ${currentUser.email}</p>
                        <p><strong>å­¦å·:</strong> ${currentUser.campus_id}</p>
                        <p><strong>æ³¨å†Œæ—¶é—´:</strong> ${new Date(currentUser.register_time).toLocaleString()}</p>
                    </div>
                `;
            } else {
                element.innerHTML = '<div class="alert alert-info">å½“å‰æ²¡æœ‰ç”¨æˆ·ç™»å½•</div>';
            }
        }

        function displayUserList() {
            const users = getAllUsers();
            const element = document.getElementById('userList');
            
            if (users.length === 0) {
                element.innerHTML = '<div class="alert alert-info">æš‚æ— ç”¨æˆ·æ•°æ®</div>';
                return;
            }
            
            let html = '<h4>ç”¨æˆ·åˆ—è¡¨</h4>';
            users.forEach(user => {
                html += `
                    <div class="item-card">
                        <div class="item-header">
                            <div class="item-title">${user.username}</div>
                            <div class="item-category">${user.is_verified ? 'å·²éªŒè¯' : 'æœªéªŒè¯'}</div>
                        </div>
                        <div class="item-description">
                            <p><strong>é‚®ç®±:</strong> ${user.email}</p>
                            <p><strong>å­¦å·:</strong> ${user.campus_id}</p>
                            <p><strong>æ³¨å†Œæ—¶é—´:</strong> ${new Date(user.register_time).toLocaleString()}</p>
                        </div>
                    </div>
                `;
            });
            
            element.innerHTML = html;
        }

        // ç‰©å“ç®¡ç†åŠŸèƒ½
        document.getElementById('itemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('itemMessage', 'è¯·å…ˆç™»å½•åå†å‘å¸ƒç‰©å“', 'error');
                return;
            }
            
            const title = document.getElementById('itemTitle').value;
            const description = document.getElementById('itemDescription').value;
            const price = parseFloat(document.getElementById('itemPrice').value);
            const category = document.getElementById('itemCategory').value;
            
            const newItem = {
                item_id: generateId('item'),
                user_id: currentUser.user_id,
                title: title,
                description: description,
                price: price,
                category: category,
                status: 'å¾…å”®',
                create_time: new Date().toISOString()
            };
            
            const items = getAllItems();
            items.push(newItem);
            saveItems(items);
            
            // æ¸…ç©ºè¡¨å•
            this.reset();
            
            showMessage('itemMessage', 'ç‰©å“å‘å¸ƒæˆåŠŸï¼', 'success');
            loadAllItems();
            refreshStats();
        });

        function searchItems() {
            const keyword = document.getElementById('searchKeyword').value.toLowerCase();
            const category = document.getElementById('searchCategory').value;
            
            let items = getAllItems();
            
            // æŒ‰å…³é”®è¯æœç´¢
            if (keyword) {
                items = items.filter(item => 
                    item.title.toLowerCase().includes(keyword) || 
                    item.description.toLowerCase().includes(keyword)
                );
            }
            
            // æŒ‰åˆ†ç±»ç­›é€‰
            if (category) {
                items = items.filter(item => item.category === category);
            }
            
            displayItems(items);
            showMessage('itemMessage', `æ‰¾åˆ° ${items.length} ä¸ªç¬¦åˆæ¡ä»¶çš„ç‰©å“`, 'success');
        }

        function loadAllItems() {
            const items = getAllItems();
            displayItems(items);
        }

        function displayItems(items) {
            const element = document.getElementById('itemList');
            
            if (items.length === 0) {
                element.innerHTML = '<div class="alert alert-info">æš‚æ— ç‰©å“æ•°æ®</div>';
                return;
            }
            
            let html = '<h4>ç‰©å“åˆ—è¡¨</h4>';
            items.forEach(item => {
                const statusClass = item.status === 'å¾…å”®' ? 'status-available' : 'status-sold';
                html += `
                    <div class="item-card">
                        <div class="item-header">
                            <div class="item-title">${item.title}</div>
                            <div class="item-price">Â¥${item.price.toFixed(2)}</div>
                        </div>
                        <div class="item-description">${item.description}</div>
                        <div class="item-footer">
                            <div class="item-category">${item.category}</div>
                            <div class="item-status ${statusClass}">${item.status}</div>
                        </div>
                    </div>
                `;
            });
            
            element.innerHTML = html;
        }

        // äº¤æ˜“ç®¡ç†åŠŸèƒ½
        function createTransaction() {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('transactionMessage', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            const items = getAllItems();
            if (items.length === 0) {
                showMessage('transactionMessage', 'æš‚æ— ç‰©å“å¯äº¤æ˜“', 'error');
                return;
            }
            
            const item = items[0]; // é€‰æ‹©ç¬¬ä¸€ä¸ªç‰©å“
            const newTransaction = {
                transaction_id: generateId('transaction'),
                item_id: item.item_id,
                buyer_id: currentUser.user_id,
                seller_id: item.user_id,
                status: 'äº¤æ˜“ä¸­',
                create_time: new Date().toISOString()
            };
            
            const transactions = getAllTransactions();
            transactions.push(newTransaction);
            saveTransactions(transactions);
            
            // æ›´æ–°ç‰©å“çŠ¶æ€
            const updatedItems = items.map(i => 
                i.item_id === item.item_id ? { ...i, status: 'äº¤æ˜“ä¸­' } : i
            );
            saveItems(updatedItems);
            
            showMessage('transactionMessage', 'äº¤æ˜“åˆ›å»ºæˆåŠŸï¼', 'success');
            loadTransactions();
            refreshStats();
        }

        function loadTransactions() {
            const transactions = getAllTransactions();
            displayTransactions(transactions);
        }

        function displayTransactions(transactions) {
            const element = document.getElementById('transactionList');
            
            if (transactions.length === 0) {
                element.innerHTML = '<div class="alert alert-info">æš‚æ— äº¤æ˜“è®°å½•</div>';
                return;
            }
            
            let html = '<h4>äº¤æ˜“è®°å½•</h4>';
            transactions.forEach(transaction => {
                html += `
                    <div class="item-card">
                        <div class="item-header">
                            <div class="item-title">äº¤æ˜“ID: ${transaction.transaction_id}</div>
                            <div class="item-price">${transaction.status}</div>
                        </div>
                        <div class="item-description">
                            <p><strong>ç‰©å“ID:</strong> ${transaction.item_id}</p>
                            <p><strong>ä¹°å®¶ID:</strong> ${transaction.buyer_id}</p>
                            <p><strong>å–å®¶ID:</strong> ${transaction.seller_id}</p>
                            <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date(transaction.create_time).toLocaleString()}</p>
                        </div>
                    </div>
                `;
            });
            
            element.innerHTML = html;
        }

        // å®Œæ•´æ¼”ç¤ºåŠŸèƒ½
        function runFullDemo() {
            demoLog('å¼€å§‹å®Œæ•´æ¼”ç¤º...');
            
            // 1. æ¸…ç©ºæ•°æ®
            localStorage.removeItem(STORAGE_KEYS.USERS);
            localStorage.removeItem(STORAGE_KEYS.ITEMS);
            localStorage.removeItem(STORAGE_KEYS.TRANSACTIONS);
            localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
            demoLog('âœ… å·²æ¸…ç©ºç°æœ‰æ•°æ®');
            
            // 2. åˆ›å»ºæ¼”ç¤ºç”¨æˆ·
            const demoUser = {
                user_id: generateId('demo_user'),
                username: 'æ¼”ç¤ºç”¨æˆ·',
                email: 'demo@campus.edu.cn',
                campus_id: '2021001000',
                password: 'demo123',
                is_verified: true,
                register_time: new Date().toISOString()
            };
            
            saveUsers([demoUser]);
            setCurrentUser(demoUser);
            demoLog('âœ… å·²åˆ›å»ºå¹¶ç™»å½•æ¼”ç¤ºç”¨æˆ·');
            
            // 3. å‘å¸ƒæ¼”ç¤ºç‰©å“
            const demoItems = [
                {
                    item_id: generateId('demo_item'),
                    user_id: demoUser.user_id,
                    title: 'ã€Šçº¿æ€§ä»£æ•°ã€‹æ•™æ',
                    description: 'åŒæµå¤§å­¦å‡ºç‰ˆç¤¾ï¼Œé€‚åˆå¤§ä¸€æ–°ç”Ÿï¼Œä¹æˆæ–°',
                    price: 28.50,
                    category: 'ä¹¦ç±',
                    status: 'å¾…å”®',
                    create_time: new Date().toISOString()
                },
                {
                    item_id: generateId('demo_item'),
                    user_id: demoUser.user_id,
                    title: 'å°ç±³å……ç”µå®',
                    description: '10000mAhå®¹é‡ï¼Œæ”¯æŒå¿«å……ï¼Œä½¿ç”¨åŠå¹´',
                    price: 85.00,
                    category: 'ç”µå­äº§å“',
                    status: 'å¾…å”®',
                    create_time: new Date().toISOString()
                }
            ];
            
            saveItems(demoItems);
            demoLog('âœ… å·²å‘å¸ƒ2ä¸ªæ¼”ç¤ºç‰©å“');
            
            // 4. åˆ›å»ºæ¼”ç¤ºäº¤æ˜“
            const demoTransaction = {
                transaction_id: generateId('demo_transaction'),
                item_id: demoItems[0].item_id,
                buyer_id: demoUser.user_id,
                seller_id: demoUser.user_id,
                status: 'äº¤æ˜“ä¸­',
                create_time: new Date().toISOString()
            };
            
            saveTransactions([demoTransaction]);
            demoLog('âœ… å·²åˆ›å»ºæ¼”ç¤ºäº¤æ˜“');
            
            // 5. åˆ·æ–°ç•Œé¢
            refreshStats();
            displayCurrentUser();
            loadAllItems();
            loadTransactions();
            
            demoLog('ğŸ‰ å®Œæ•´æ¼”ç¤ºå®Œæˆï¼');
            showMessage('demoMessage', 'å®Œæ•´æ¼”ç¤ºè¿è¡ŒæˆåŠŸï¼è¯·æŸ¥çœ‹å„æ ‡ç­¾é¡µçš„æ•°æ®', 'success');
        }

        function demoUserFlow() {
            demoLog('å¼€å§‹ç”¨æˆ·æµç¨‹æ¼”ç¤º...');
            
            // æ¸…ç©ºç”¨æˆ·æ•°æ®
            localStorage.removeItem(STORAGE_KEYS.USERS);
            localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
            
            // æ¨¡æ‹Ÿç”¨æˆ·æ³¨å†Œ
            const newUser = {
                user_id: generateId('flow_user'),
                username: 'æµç¨‹æµ‹è¯•ç”¨æˆ·',
                email: 'flow@campus.edu.cn',
                campus_id: '2021002001',
                password: 'flow123',
                is_verified: true,
                register_time: new Date().toISOString()
            };
            
            saveUsers([newUser]);
            demoLog('âœ… ç”¨æˆ·æ³¨å†ŒæˆåŠŸ');
            
            // æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•
            setCurrentUser(newUser);
            demoLog('âœ… ç”¨æˆ·ç™»å½•æˆåŠŸ');
            
            // åˆ·æ–°ç•Œé¢
            displayCurrentUser();
            displayUserList();
            refreshStats();
            
            demoLog('ğŸ‰ ç”¨æˆ·æµç¨‹æ¼”ç¤ºå®Œæˆï¼');
            showMessage('demoMessage', 'ç”¨æˆ·æµç¨‹æ¼”ç¤ºæˆåŠŸï¼', 'success');
        }

        function demoItemFlow() {
            demoLog('å¼€å§‹ç‰©å“æµç¨‹æ¼”ç¤º...');
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                demoLog('âŒ è¯·å…ˆç™»å½•ç”¨æˆ·');
                showMessage('demoMessage', 'è¯·å…ˆç™»å½•åå†è¿›è¡Œç‰©å“æµç¨‹æ¼”ç¤º', 'error');
                return;
            }
            
            // æ¸…ç©ºç‰©å“æ•°æ®
            localStorage.removeItem(STORAGE_KEYS.ITEMS);
            localStorage.removeItem(STORAGE_KEYS.TRANSACTIONS);
            
            // å‘å¸ƒæµ‹è¯•ç‰©å“
            const testItem = {
                item_id: generateId('flow_item'),
                user_id: currentUser.user_id,
                title: 'æµ‹è¯•ç‰©å“ - è®¡ç®—å™¨',
                description: 'å¡è¥¿æ¬§ç§‘å­¦è®¡ç®—å™¨ï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œé€‚åˆè€ƒè¯•ä½¿ç”¨',
                price: 45.00,
                category: 'ç”µå­äº§å“',
                status: 'å¾…å”®',
                create_time: new Date().toISOString()
            };
            
            saveItems([testItem]);
            demoLog('âœ… ç‰©å“å‘å¸ƒæˆåŠŸ');
            
            // æœç´¢ç‰©å“
            const items = getAllItems();
            const searchResults = items.filter(item => 
                item.title.toLowerCase().includes('è®¡ç®—å™¨') || 
                item.description.toLowerCase().includes('è®¡ç®—å™¨')
            );
            demoLog(`âœ… æœç´¢åˆ° ${searchResults.length} ä¸ªç›¸å…³ç‰©å“`);
            
            // åˆ›å»ºäº¤æ˜“
            const transaction = {
                transaction_id: generateId('flow_transaction'),
                item_id: testItem.item_id,
                buyer_id: currentUser.user_id,
                seller_id: currentUser.user_id,
                status: 'äº¤æ˜“ä¸­',
                create_time: new Date().toISOString()
            };
            
            saveTransactions([transaction]);
            demoLog('âœ… äº¤æ˜“åˆ›å»ºæˆåŠŸ');
            
            // åˆ·æ–°ç•Œé¢
            loadAllItems();
            loadTransactions();
            
            demoLog('ğŸ‰ ç‰©å“æµç¨‹æ¼”ç¤ºå®Œæˆï¼');
            showMessage('demoMessage', 'ç‰©å“æµç¨‹æ¼”ç¤ºæˆåŠŸï¼', 'success');
        }

        function demoLog(message) {
            const logElement = document.getElementById('demoLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<div class="alert alert-info">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            refreshStats();
            displayCurrentUser();
            loadAllItems();
        };
    </script>
</body>
</html>