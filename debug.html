<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调试页面</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>本地存储调试</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>用户数据</h3>
                <div id="userData" class="bg-light p-3 rounded"></div>
            </div>
            <div class="col-md-6">
                <h3>物品数据</h3>
                <div id="itemData" class="bg-light p-3 rounded"></div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <h3>交易数据</h3>
                <div id="transactionData" class="bg-light p-3 rounded"></div>
            </div>
            <div class="col-md-6">
                <h3>评价数据</h3>
                <div id="ratingData" class="bg-light p-3 rounded"></div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>测试功能</h3>
                <button class="btn btn-primary" onclick="testLocalStorage()">测试本地存储</button>
                <button class="btn btn-secondary" onclick="clearLocalStorage()">清空本地存储</button>
                <button class="btn btn-success" onclick="addTestData()">添加测试数据</button>
                <div id="testResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        // 显示本地存储数据
        function displayData() {
            // 用户数据
            const users = JSON.parse(localStorage.getItem('xianwu_users') || '[]');
            document.getElementById('userData').innerHTML = `<pre>${JSON.stringify(users, null, 2)}</pre>`;
            
            // 物品数据
            const items = JSON.parse(localStorage.getItem('xianwu_items') || '[]');
            document.getElementById('itemData').innerHTML = `<pre>${JSON.stringify(items, null, 2)}</pre>`;
            
            // 交易数据
            const transactions = JSON.parse(localStorage.getItem('xianwu_transactions') || '[]');
            document.getElementById('transactionData').innerHTML = `<pre>${JSON.stringify(transactions, null, 2)}</pre>`;
            
            // 评价数据
            const ratings = JSON.parse(localStorage.getItem('xianwu_ratings') || '[]');
            document.getElementById('ratingData').innerHTML = `<pre>${JSON.stringify(ratings, null, 2)}</pre>`;
        }

        // 测试本地存储
        function testLocalStorage() {
            try {
                // 测试写入
                localStorage.setItem('test_key', 'test_value');
                const value = localStorage.getItem('test_key');
                
                if (value === 'test_value') {
                    document.getElementById('testResult').innerHTML = '<div class="alert alert-success">本地存储正常工作！</div>';
                    localStorage.removeItem('test_key');
                } else {
                    document.getElementById('testResult').innerHTML = '<div class="alert alert-danger">本地存储读取失败！</div>';
                }
            } catch (error) {
                document.getElementById('testResult').innerHTML = '<div class="alert alert-danger">错误: ' + error.message + '</div>';
            }
        }

        // 清空本地存储
        function clearLocalStorage() {
            if (confirm('确定要清空所有本地存储数据吗？')) {
                localStorage.clear();
                displayData();
                document.getElementById('testResult').innerHTML = '<div class="alert alert-info">本地存储已清空！</div>';
            }
        }

        // 添加测试数据
        function addTestData() {
            try {
                // 添加测试用户
                const testUser = {
                    user_id: 'test_user_123',
                    username: '测试用户',
                    email: 'test@example.com',
                    campus_id: '2021001234',
                    avatar: 'https://via.placeholder.com/150/4f46e5/ffffff?text=测',
                    register_time: new Date().toISOString(),
                    is_verified: true,
                    password: '123456'
                };

                let users = JSON.parse(localStorage.getItem('xianwu_users') || '[]');
                users.push(testUser);
                localStorage.setItem('xianwu_users', JSON.stringify(users));

                // 添加测试物品
                const testItem = {
                    item_id: 'test_item_123',
                    user_id: 'test_user_123',
                    title: '测试物品',
                    description: '这是一个测试物品',
                    price: 99.99,
                    category: '书籍',
                    status: '待售',
                    image_url: 'https://via.placeholder.com/300x200/4f46e5/ffffff?text=测试',
                    create_time: new Date().toISOString()
                };

                let items = JSON.parse(localStorage.getItem('xianwu_items') || '[]');
                items.push(testItem);
                localStorage.setItem('xianwu_items', JSON.stringify(items));

                displayData();
                document.getElementById('testResult').innerHTML = '<div class="alert alert-success">测试数据添加成功！</div>';
            } catch (error) {
                document.getElementById('testResult').innerHTML = '<div class="alert alert-danger">错误: ' + error.message + '</div>';
            }
        }

        // 页面加载时显示数据
        displayData();
    </script>
</body>
</html>