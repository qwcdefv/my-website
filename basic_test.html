<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—²ç‰©æ ¡å›­ - åŸºç¡€åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; background-color: #fafafa; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #17a2b8; }
        button { margin: 5px; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-info { background-color: #17a2b8; color: white; }
        input, select { margin: 5px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .result-box { margin-top: 10px; padding: 10px; border-radius: 5px; background-color: white; border: 1px solid #ddd; }
        .hidden { display: none; }
        .user-card { background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .item-card { background: #fff; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .item-title { font-weight: bold; color: #333; }
        .item-price { color: #e74c3c; font-size: 18px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">ğŸ“ é—²ç‰©æ ¡å›­ - åŠŸèƒ½æµ‹è¯•ä¸­å¿ƒ</h1>
        
        <!-- ç³»ç»ŸçŠ¶æ€æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”§ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
            <button class="btn-info" onclick="checkSystemStatus()">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
            <button class="btn-primary" onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
            <button class="btn-success" onclick="showAllData()">æ˜¾ç¤ºæ‰€æœ‰æ•°æ®</button>
            <button class="btn-danger" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <div id="systemStatus" class="result-box"></div>
        </div>
        
        <!-- ç”¨æˆ·ç®¡ç†æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ‘¥ ç”¨æˆ·ç®¡ç†æµ‹è¯•</h3>
            <button class="btn-success" onclick="addTestUsers()">æ·»åŠ æµ‹è¯•ç”¨æˆ·</button>
            <button class="btn-primary" onclick="showAllUsers()">æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·</button>
            <div id="userManagement" class="result-box"></div>
        </div>
        
        <!-- ç™»å½•åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ” ç™»å½•åŠŸèƒ½æµ‹è¯•</h3>
            <div>
                <input type="email" id="loginEmail" placeholder="é‚®ç®±" value="zhang@example.com" style="width: 200px;">
                <br>
                <input type="password" id="loginPassword" placeholder="å¯†ç " value="123456" style="width: 200px;">
                <br>
                <button class="btn-primary" onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
                <button class="btn-success" onclick="testLogout()">æµ‹è¯•ç™»å‡º</button>
            </div>
            <div id="loginTest" class="result-box"></div>
        </div>
        
        <!-- ç‰©å“ç®¡ç†æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“¦ ç‰©å“ç®¡ç†æµ‹è¯•</h3>
            <button class="btn-success" onclick="addTestItems()">æ·»åŠ æµ‹è¯•ç‰©å“</button>
            <button class="btn-primary" onclick="showAllItems()">æ˜¾ç¤ºæ‰€æœ‰ç‰©å“</button>
            <button class="btn-info" onclick="searchItems()">æœç´¢æµ‹è¯•</button>
            <div id="itemManagement" class="result-box"></div>
        </div>
        
        <!-- äº¤æ˜“ç®¡ç†æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ¤ äº¤æ˜“ç®¡ç†æµ‹è¯•</h3>
            <button class="btn-success" onclick="addTestTransactions()">æ·»åŠ æµ‹è¯•äº¤æ˜“</button>
            <button class="btn-primary" onclick="showAllTransactions()">æ˜¾ç¤ºæ‰€æœ‰äº¤æ˜“</button>
            <div id="transactionManagement" class="result-box"></div>
        </div>
        
        <!-- å¿«é€ŸåŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸš€ å¿«é€ŸåŠŸèƒ½æµ‹è¯•</h3>
            <button class="btn-success" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn-info" onclick="initializeTestData()">åˆå§‹åŒ–æµ‹è¯•æ•°æ®</button>
            <div id="quickTest" class="result-box"></div>
        </div>
    </div>

    <script>
        // ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        function checkSystemStatus() {
            const status = {
                localStorage: typeof(Storage) !== "undefined",
                bootstrap: typeof(bootstrap) !== "undefined",
                jquery: typeof($) !== "undefined",
                date: new Date().toLocaleString()
            };
            
            let html = '<h4>ç³»ç»ŸçŠ¶æ€:</h4>';
            for (let key in status) {
                html += `<div>${key}: <span class="${status[key] ? 'success' : 'error'}">${status[key] ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}</span></div>`;
            }
            document.getElementById('systemStatus').innerHTML = html;
        }
        
        // æµ‹è¯•æœ¬åœ°å­˜å‚¨
        function testLocalStorage() {
            try {
                localStorage.setItem('test_key', 'test_value');
                const value = localStorage.getItem('test_key');
                localStorage.removeItem('test_key');
                
                document.getElementById('systemStatus').innerHTML = 
                    `<span class="success">âœ… æœ¬åœ°å­˜å‚¨æµ‹è¯•é€šè¿‡ï¼å¯ä»¥æ­£å¸¸è¯»å†™æ•°æ®ã€‚</span>`;
            } catch (error) {
                document.getElementById('systemStatus').innerHTML = 
                    `<span class="error">âŒ æœ¬åœ°å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}</span>`;
            }
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
        function showAllData() {
            let html = '<h4>æœ¬åœ°å­˜å‚¨ä¸­çš„æ‰€æœ‰æ•°æ®:</h4>';
            
            if (localStorage.length === 0) {
                html += '<div class="info">æœ¬åœ°å­˜å‚¨ä¸ºç©º</div>';
            } else {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    html += `<div class="user-card"><strong>${key}:</strong><br>${value.substring(0, 200)}${value.length > 200 ? '...' : ''}</div>`;
                }
            }
            
            document.getElementById('systemStatus').innerHTML = html;
        }
        
        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('âš ï¸ è­¦å‘Šï¼šè¿™å°†æ¸…ç©ºæ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                localStorage.clear();
                document.getElementById('systemStatus').innerHTML = 
                    '<span class="success">âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º</span>';
            }
        }
        
        // æ·»åŠ æµ‹è¯•ç”¨æˆ·
        function addTestUsers() {
            const testUsers = [
                {
                    user_id: 'user_001',
                    username: 'å¼ åŒå­¦',
                    email: 'zhang@example.com',
                    campus_id: '2021001001',
                    phone: '13800138001',
                    avatar: 'https://via.placeholder.com/150/4f46e5/ffffff?text=å¼ ',
                    register_time: new Date().toISOString(),
                    is_verified: true,
                    password: '123456'
                },
                {
                    user_id: 'user_002',
                    username: 'æåŒå­¦',
                    email: 'li@example.com',
                    campus_id: '2021001002',
                    phone: '13800138002',
                    avatar: 'https://via.placeholder.com/150/7c3aed/ffffff?text=æ',
                    register_time: new Date().toISOString(),
                    is_verified: true,
                    password: '123456'
                }
            ];
            
            localStorage.setItem('xianwu_users', JSON.stringify(testUsers));
            document.getElementById('userManagement').innerHTML = 
                '<span class="success">âœ… æµ‹è¯•ç”¨æˆ·å·²æ·»åŠ </span>';
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·
        function showAllUsers() {
            const users = JSON.parse(localStorage.getItem('xianwu_users') || '[]');
            
            if (users.length === 0) {
                document.getElementById('userManagement').innerHTML = 
                    '<div class="info">æš‚æ— ç”¨æˆ·æ•°æ®</div>';
                return;
            }
            
            let html = '<h4>æ‰€æœ‰ç”¨æˆ·:</h4>';
            users.forEach(user => {
                html += `
                    <div class="user-card">
                        <div><strong>${user.username}</strong> (${user.is_verified ? 'âœ…å·²è®¤è¯' : 'âŒæœªè®¤è¯'})</div>
                        <div>é‚®ç®±: ${user.email}</div>
                        <div>å­¦å·: ${user.campus_id}</div>
                        <div>ç”µè¯: ${user.phone}</div>
                        <div>æ³¨å†Œæ—¶é—´: ${new Date(user.register_time).toLocaleString()}</div>
                    </div>
                `;
            });
            
            document.getElementById('userManagement').innerHTML = html;
        }
        
        // æµ‹è¯•ç™»å½•
        function testLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            console.log('æµ‹è¯•ç™»å½•:', email, password);
            
            try {
                const users = JSON.parse(localStorage.getItem('xianwu_users') || '[]');
                console.log('ç”¨æˆ·åˆ—è¡¨:', users);
                const user = users.find(u => u.email === email && u.password === password);
                console.log('æ‰¾åˆ°ç”¨æˆ·:', user);
                
                if (user) {
                    localStorage.setItem('xianwu_current_user', JSON.stringify(user));
                    document.getElementById('loginTest').innerHTML = 
                        `<span class="success">âœ… ç™»å½•æˆåŠŸï¼æ¬¢è¿ ${user.username}</span>`;
                } else {
                    document.getElementById('loginTest').innerHTML = 
                        '<span class="error">âŒ ç™»å½•å¤±è´¥ï¼šé‚®ç®±æˆ–å¯†ç é”™è¯¯</span>';
                }
            } catch (error) {
                document.getElementById('loginTest').innerHTML = 
                    `<span class="error">âŒ ç™»å½•é”™è¯¯: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•ç™»å‡º
        function testLogout() {
            localStorage.removeItem('xianwu_current_user');
            document.getElementById('loginTest').innerHTML = 
                '<span class="success">âœ… å·²é€€å‡ºç™»å½•</span>';
        }
        
        // æ·»åŠ æµ‹è¯•ç‰©å“
        function addTestItems() {
            const testItems = [
                {
                    item_id: 'item_001',
                    user_id: 'user_001',
                    title: 'é«˜ç­‰æ•°å­¦æ•™æï¼ˆç¬¬ä¸ƒç‰ˆï¼‰',
                    description: 'åŒæµå¤§å­¦æ•°å­¦ç³»ç¼–ï¼Œé«˜ç­‰æ•™è‚²å‡ºç‰ˆç¤¾ï¼Œä¹æˆæ–°ï¼Œæ— ç¬”è®°æ— åˆ’çº¿ï¼Œé€‚åˆå¤§ä¸€æ–°ç”Ÿä½¿ç”¨ã€‚',
                    price: 35.00,
                    category: 'ä¹¦ç±',
                    status: 'å¾…å”®',
                    image_url: 'https://via.placeholder.com/300x200/4f46e5/ffffff?text=é«˜æ•°æ•™æ',
                    create_time: new Date().toISOString()
                },
                {
                    item_id: 'item_002',
                    user_id: 'user_002',
                    title: 'å°ç±³è“ç‰™è€³æœº',
                    description: 'å°ç±³Air2 SEï¼Œä½¿ç”¨åŠå¹´ï¼ŒåŠŸèƒ½æ­£å¸¸ï¼ŒéŸ³è´¨æ¸…æ™°ï¼Œç»­èˆªè‰¯å¥½ï¼Œé…ä»¶é½å…¨ã€‚',
                    price: 120.00,
                    category: 'ç”µå­äº§å“',
                    status: 'å¾…å”®',
                    image_url: 'https://via.placeholder.com/300x200/7c3aed/ffffff?text=è“ç‰™è€³æœº',
                    create_time: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('xianwu_items', JSON.stringify(testItems));
            document.getElementById('itemManagement').innerHTML = 
                '<span class="success">âœ… æµ‹è¯•ç‰©å“å·²æ·»åŠ </span>';
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰ç‰©å“
        function showAllItems() {
            const items = JSON.parse(localStorage.getItem('xianwu_items') || '[]');
            
            if (items.length === 0) {
                document.getElementById('itemManagement').innerHTML = 
                    '<div class="info">æš‚æ— ç‰©å“æ•°æ®</div>';
                return;
            }
            
            let html = '<h4>æ‰€æœ‰ç‰©å“:</h4>';
            items.forEach(item => {
                html += `
                    <div class="item-card">
                        <div class="item-title">${item.title}</div>
                        <div class="item-price">Â¥${item.price.toFixed(2)}</div>
                        <div>åˆ†ç±»: ${item.category} | çŠ¶æ€: ${item.status}</div>
                        <div>æè¿°: ${item.description}</div>
                        <div>å‘å¸ƒæ—¶é—´: ${new Date(item.create_time).toLocaleString()}</div>
                    </div>
                `;
            });
            
            document.getElementById('itemManagement').innerHTML = html;
        }
        
        // æœç´¢æµ‹è¯•
        function searchItems() {
            const items = JSON.parse(localStorage.getItem('xianwu_items') || '[]');
            const keyword = 'æ•°å­¦'; // æµ‹è¯•å…³é”®è¯
            
            const filteredItems = items.filter(item => 
                item.title.toLowerCase().includes(keyword.toLowerCase()) || 
                item.description.toLowerCase().includes(keyword.toLowerCase())
            );
            
            let html = `<h4>æœç´¢ "${keyword}" çš„ç»“æœ:</h4>`;
            if (filteredItems.length === 0) {
                html += '<div class="info">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç‰©å“</div>';
            } else {
                filteredItems.forEach(item => {
                    html += `
                        <div class="item-card">
                            <div class="item-title">${item.title}</div>
                            <div class="item-price">Â¥${item.price.toFixed(2)}</div>
                            <div>åˆ†ç±»: ${item.category} | çŠ¶æ€: ${item.status}</div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('itemManagement').innerHTML = html;
        }
        
        // æ·»åŠ æµ‹è¯•äº¤æ˜“
        function addTestTransactions() {
            const testTransactions = [
                {
                    transaction_id: 'trans_001',
                    item_id: 'item_001',
                    buyer_id: 'user_002',
                    seller_id: 'user_001',
                    status: 'äº¤æ˜“ä¸­',
                    create_time: new Date().toISOString(),
                    complete_time: null
                }
            ];
            
            localStorage.setItem('xianwu_transactions', JSON.stringify(testTransactions));
            document.getElementById('transactionManagement').innerHTML = 
                '<span class="success">âœ… æµ‹è¯•äº¤æ˜“å·²æ·»åŠ </span>';
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰äº¤æ˜“
        function showAllTransactions() {
            const transactions = JSON.parse(localStorage.getItem('xianwu_transactions') || '[]');
            const items = JSON.parse(localStorage.getItem('xianwu_items') || '[]');
            const users = JSON.parse(localStorage.getItem('xianwu_users') || '[]');
            
            if (transactions.length === 0) {
                document.getElementById('transactionManagement').innerHTML = 
                    '<div class="info">æš‚æ— äº¤æ˜“æ•°æ®</div>';
                return;
            }
            
            let html = '<h4>æ‰€æœ‰äº¤æ˜“:</h4>';
            transactions.forEach(transaction => {
                const item = items.find(i => i.item_id === transaction.item_id);
                const buyer = users.find(u => u.user_id === transaction.buyer_id);
                const seller = users.find(u => u.user_id === transaction.seller_id);
                
                html += `
                    <div class="user-card">
                        <div><strong>äº¤æ˜“ID:</strong> ${transaction.transaction_id}</div>
                        <div><strong>ç‰©å“:</strong> ${item?.title || 'æœªçŸ¥ç‰©å“'}</div>
                        <div><strong>ä¹°å®¶:</strong> ${buyer?.username || 'æœªçŸ¥ä¹°å®¶'}</div>
                        <div><strong>å–å®¶:</strong> ${seller?.username || 'æœªçŸ¥å–å®¶'}</div>
                        <div><strong>çŠ¶æ€:</strong> ${transaction.status}</div>
                        <div><strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date(transaction.create_time).toLocaleString()}</div>
                    </div>
                `;
            });
            
            document.getElementById('transactionManagement').innerHTML = html;
        }
        
        // åˆå§‹åŒ–æµ‹è¯•æ•°æ®
        function initializeTestData() {
            addTestUsers();
            addTestItems();
            addTestTransactions();
            document.getElementById('quickTest').innerHTML = 
                '<span class="success">âœ… æ‰€æœ‰æµ‹è¯•æ•°æ®å·²åˆå§‹åŒ–</span>';
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            let results = [];
            
            // æµ‹è¯•1: æœ¬åœ°å­˜å‚¨
            try {
                localStorage.setItem('test', 'value');
                localStorage.getItem('test');
                localStorage.removeItem('test');
                results.push('âœ… æœ¬åœ°å­˜å‚¨æµ‹è¯•é€šè¿‡');
            } catch (error) {
                results.push('âŒ æœ¬åœ°å­˜å‚¨æµ‹è¯•å¤±è´¥: ' + error.message);
            }
            
            // æµ‹è¯•2: ç”¨æˆ·æ•°æ®æ“ä½œ
            try {
                const testUser = {id: 1, name: 'æµ‹è¯•ç”¨æˆ·'};
                let users = JSON.parse(localStorage.getItem('xianwu_users') || '[]');
                users.push(testUser);
                localStorage.setItem('xianwu_users', JSON.stringify(users));
                const retrieved = JSON.parse(localStorage.getItem('xianwu_users'));
                results.push('âœ… ç”¨æˆ·æ•°æ®æ“ä½œæµ‹è¯•é€šè¿‡');
            } catch (error) {
                results.push('âŒ ç”¨æˆ·æ•°æ®æ“ä½œæµ‹è¯•å¤±è´¥: ' + error.message);
            }
            
            // æµ‹è¯•3: æœç´¢åŠŸèƒ½
            try {
                const items = [
                    {title: 'æ•°å­¦ä¹¦', description: 'é«˜ç­‰æ•°å­¦æ•™æ'},
                    {title: 'è‹±è¯­ä¹¦', description: 'å¤§å­¦è‹±è¯­æ•™ç¨‹'}
                ];
                const keyword = 'æ•°å­¦';
                const results = items.filter(item => 
                    item.title.toLowerCase().includes(keyword.toLowerCase()) || 
                    item.description.toLowerCase().includes(keyword.toLowerCase())
                );
                results.push('âœ… æœç´¢åŠŸèƒ½æµ‹è¯•é€šè¿‡');
            } catch (error) {
                results.push('âŒ æœç´¢åŠŸèƒ½æµ‹è¯•å¤±è´¥: ' + error.message);
            }
            
            document.getElementById('quickTest').innerHTML = 
                '<h4>æµ‹è¯•ç»“æœ:</h4>' + results.map(r => `<div>${r}</div>`).join('');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.onload = function() {
            checkSystemStatus();
        };
    </script>
</body>
</html>